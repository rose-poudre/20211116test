<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>é£Ÿäº‹å…¥åŠ›</title>
  </head>
  <body>
    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºå†…å®¹ -->
    <div class="container">
      <!-- <label class="name">æ¤œç´¢</label> -->
      <input
        type="text"
        id="search_box"
        placeholder="ã²ã‚‰ãŒãªã§æ¤œç´¢ï¼ˆä¾‹:ãŠã«ãã‚Šï¼‰"
        style="width: 300px"
      />
      <button id="selbtn" style="background-color: aqua">SELECT</button
      ><br /><br />

      <!-- æ¤œç´¢ã—ãŸã‚‚ã®ã‚’è¡¨ç¤º -->
      <div id="search">
        <label class="">é£Ÿå“å</label>
        <input type="text" id="name_box" style="border: none; width: 100px" />
        <label class="">ã‚«ãƒ­ãƒªãƒ¼</label>
        <input
          type="text"
          id="cal_box"
          style="border: none; width: 50px"
        />kcal<br /><br />
        <label class="">ã‚¿ãƒ³ãƒ‘ã‚¯è³ª</label>
        <input type="text" id="p_box" style="border: none; width: 20px" />g
        <label class="">è„‚è³ª</label>
        <input type="text" id="f_box" style="border: none; width: 20px" />g
        <label class="">ç‚­æ°´åŒ–ç‰©</label>
        <input
          type="text"
          id="c_box"
          style="border: none; width: 30px"
        />g<br /><br />
      </div>
      <hr />
      <!-- <button id="addbtn_1">è¿½åŠ </button>
      <button id="addbtn_2">è¿½åŠ </button>
      <button id="addbtn_3">è¿½åŠ </button> -->
      <button id="send">é€ä¿¡</button>
      <hr />
      <input type="text" id="date" placeholder="date" />
      <input type="text" id="name" placeholder="name" />
      <input type="text" id="kcal" placeholder="kcal" />
      <input type="text" id="amount" placeholder="amount" />

      <!-- è¿½åŠ ãƒœã‚¿ãƒ³æŠ¼ã—ãŸå†…å®¹è¡¨ç¤º -->
      <div id="show1" style="display: none">
        <input type="text" id="name1" style="border: none; width: 100px" />
        <!-- <label class="">ã‚«ãƒ­ãƒªãƒ¼</label> -->
        <input
          type="text"
          id="cal1"
          style="border: none; width: 50px"
        />kcal<br /><br />
        <label class="">ã‚¿ãƒ³ãƒ‘ã‚¯è³ª</label>
        <input type="text" id="p1" style="border: none; width: 20px" />g
        <label class="">è„‚è³ª</label>
        <input type="text" id="f1" style="border: none; width: 20px" />g
        <label class="">ç‚­æ°´åŒ–ç‰©</label>
        <input
          type="text"
          id="c1"
          style="border: none; width: 30px"
        />g<br /><br />
      </div>

      <div id="show2" style="display: none">
        <input type="text" id="name2" style="border: none; width: 100px" />
        <!-- <label class="">ã‚«ãƒ­ãƒªãƒ¼</label> -->
        <input
          type="text"
          id="cal2"
          style="border: none; width: 50px"
        />kcal<br /><br />
        <label class="">ã‚¿ãƒ³ãƒ‘ã‚¯è³ª</label>
        <input type="text" id="p2" style="border: none; width: 20px" />g
        <label class="">è„‚è³ª</label>
        <input type="text" id="f2" style="border: none; width: 20px" />g
        <label class="">ç‚­æ°´åŒ–ç‰©</label>
        <input
          type="text"
          id="c2"
          style="border: none; width: 30px"
        />g<br /><br />
      </div>

      <div id="show3" style="display: none">
        <input type="text" id="name3" style="border: none; width: 100px" />
        <!-- <label class="">ã‚«ãƒ­ãƒªãƒ¼</label> -->
        <input
          type="text"
          id="cal3"
          style="border: none; width: 50px"
        />kcal<br /><br />
        <label class="">ã‚¿ãƒ³ãƒ‘ã‚¯è³ª</label>
        <input type="text" id="p3" style="border: none; width: 20px" />g
        <label class="">è„‚è³ª</label>
        <input type="text" id="f3" style="border: none; width: 20px" />g
        <label class="">ç‚­æ°´åŒ–ç‰©</label>
        <input
          type="text"
          id="c3"
          style="border: none; width: 30px"
        />g<br /><br />
      </div>

      <hr />
      <button id="insbtn">INSERT</button>
      <button id="updbtn">UPDATE</button>
      <button id="delbtn">DELETE</button>

      <!-- <button id="food">food</button> -->
      <!-- <input type="text" id="output" /> -->
    </div>
    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºå†…å®¹ -->

    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- JQuery -->

    <!--** ä»¥ä¸‹Firebase **-->
    <script type="module">
      //ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆã‚ã›ã‚‹

      "use strict";
      //firebaseã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.1/firebase-app.js";

      //firebase-authã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰
      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut,
        onAuthStateChanged,
        updateProfile,
      } from "https://www.gstatic.com/firebasejs/9.4.1/firebase-auth.js"; //æ•°å­—ã‚’åˆã‚ã›ã‚‹

      //firestoreã‚’ä½¿ã†ãŸã‚ã®ã‚³ãƒ¼ãƒ‰
      import {
        //importå†…ã¯ä½¿ç”¨ã™ã‚‹é–¢æ•°ã‚’å®šç¾©
        getFirestore,
        collection,
        doc,
        addDoc,
        getDoc,
        setDoc,
        updateDoc,
        deleteDoc,
        deleteField,
        serverTimestamp,
        query,
        orderBy,
        onSnapshot,
        Timestamp,
      } from "https://www.gstatic.com/firebasejs/9.4.1/firebase-firestore.js"; //importã«å®šç¾©ã—ãŸã®ã‚’firestoreã§ä½¿ç”¨

      //storegeã‚’ä½¿ã†ãŸã‚ã®ã‚³ãƒ¼ãƒ‰
      import {
        getStorage,
        ref,
        uploadBytes,
        getDownloadURL,
      } from "https://www.gstatic.com/firebasejs/9.4.1/firebase-storage.js";

      //APIkey è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰
      const firebaseConfig = {
        apiKey: "AIzaSyCUy1E0IFrIsByIZnmjFiRvSUOu96tsaAQ",
        authDomain: "health-check-fd5a1.firebaseapp.com",
        projectId: "health-check-fd5a1",
        storageBucket: "health-check-fd5a1.appspot.com",
        messagingSenderId: "1065531527870",
        appId: "1:1065531527870:web:48572790a6b3940ddb84ef",
      };

      //Firebaseã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®å¤‰æ•°
      const app = initializeApp(firebaseConfig);
      //authenticaltionã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®å¤‰æ•°
      const auth = getAuth(app);
      //Firestoreã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®å¤‰æ•°
      const db = getFirestore(app);
      //storageã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®å¤‰æ•°
      const storage = getStorage(app);

      //------------------firestore-------------------------------------------//

      //ãƒ†ã‚­ã‚¹ãƒˆãƒ»ãƒœã‚¿ãƒ³å®šæ•°ã‚’å®šç¾©
      let searchbox = document.getElementById("search_box");
      let namebox = document.getElementById("name_box");
      let calbox = document.getElementById("cal_box");
      let pbox = document.getElementById("p_box");
      let fbox = document.getElementById("f_box");
      let cbox = document.getElementById("c_box");

      let insbtn = document.getElementById("insbtn");
      let selbtn = document.getElementById("selbtn");
      let updbtn = document.getElementById("updbtn");
      let delbtn = document.getElementById("delbtn");
      let food = document.getElementById("food");

      //INSERTãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      $("#insbtn").on("click", function () {
        const ob = {
          //inputã‚¿ã‚°,id=search_boxã‚’å–å¾—
          SearchOfFood: $("#search_box").val(),
          //inputã‚¿ã‚°,id=name_boxã‚’å–å¾—
          NameOfFood: $("#name_box").val(),
          //inputã‚¿ã‚°,id=cal_boxã‚’å–å¾—
          Calorie: $("#cal_box").val(),
          //inputã‚¿ã‚°,id=p_boxã‚’å–å¾—
          Protein: $("#p_box").val(),
          //inputã‚¿ã‚°,id=f_boxã‚’å–å¾—
          Fat: $("#f_box").val(),
          //inputã‚¿ã‚°,id=c_boxã‚’å–å¾—
          Carbo: $("#c_box").val(),
        };

        //ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã€ŒFoodListã€å†…ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ŒNameOfFoodã€ã‚’ã‚»ãƒƒãƒˆ
        setDoc(doc(db, "FoodList", search_box.value), ob);
        try {
          //ã‚»ãƒƒãƒˆæˆåŠŸã—ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("data added successfully!!");
          $("#search_box").val("");
          $("#name_box").val("");
          $("#cal_box").val("");
          $("#p_box").val("");
          $("#f_box").val("");
          $("#c_box").val("");
        } catch (error) {
          //ã‚»ãƒƒãƒˆå¤±æ•—ã—ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("Unsuccessful operation error");
        }
      });

      /////////////////////SELECTã‚»ã‚¯ã‚·ãƒ§ãƒ³////////////////////////
      // selãƒœã‚¿ãƒ³ã‚’æŠ¼ã™â†’SearchOfFoodã‹ã‚‰firestoreä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›
      async function GetDocument() {
        //firestoreå†…ã®SearchOfFoodã‚’å–å¾—
        const docsnap = await getDoc(doc(db, "FoodList", search_box.value));
        console.log(docsnap);
        //â†‘ä½•å›ã‚‚æ›¸ã„ã¦è¦šãˆã‚‹
        if (docsnap.exists()) {
          //firestoreã«search_boxã«ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã¨ã
          $("#search").show();
          //name_boxã«firestoreã®NameOfFoodã‚’è¡¨ç¤º
          $("#name_box").val(docsnap.data().NameOfFood);
          //cal_boxã«firestoreã®Calorieã‚’è¡¨ç¤º
          $("#cal_box").val(docsnap.data().Calorie);
          //p_boxã«firestoreã®Proteinã‚’è¡¨ç¤º
          $("#p_box").val(docsnap.data().Protein);
          //f_boxã«firestoreã®Fatã‚’è¡¨ç¤º
          $("#f_box").val(docsnap.data().Fat);
          //c_boxã«firestoreã®Carboã‚’è¡¨ç¤º
          $("#c_box").val(docsnap.data().Calorie);
        } else {
          //ãªã„æ™‚â†’ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("No such Document....");
        }
      }
      //ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      selbtn.addEventListener("click", GetDocument);
      /////////////////////////////////////////////

      // addãƒœã‚¿ãƒ³ã‚’æŠ¼ã™â†’SearchOfFoodã‹ã‚‰firestoreä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›
      //section1
      // async function AddDocument() {
      //   //firestoreå†…ã®RollNoã‚’å–å¾—
      //   const docsnap = await getDoc(doc(db, "Food"));
      //   console.log(docsnap);
      //   //â†‘ä½•å›ã‚‚æ›¸ã„ã¦è¦šãˆã‚‹
      //   if (docsnap.exists()) {
      //     // firestoreã«search_boxã«ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã¨ã
      //     $("#show1").show();
      //     // name1ã«firestoreã®NameOfFoodã‚’è¡¨ç¤º;
      //     $("#name1").val(docsnap.data().NameOfFood);
      //     console.log(docsnap);
      //     //cal1ã«firestoreã®Calorieã‚’è¡¨ç¤º
      //     $("#cal1").val(docsnap.data().Calorie);
      //     //p1ã«firestoreã®Proteinã‚’è¡¨ç¤º
      //     $("#p1").val(docsnap.data().Protein);
      //     //f1ã«firestoreã®Fatã‚’è¡¨ç¤º
      //     $("#f1").val(docsnap.data().Fat);
      //     //c1ã«firestoreã®Carboã‚’è¡¨ç¤º
      //     $("#c1").val(docsnap.data().Calorie);
      //   } else {
      //     //ãªã„æ™‚â†’ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
      //     alert("No such Document....");
      //   }
      // }
      // //ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      // addbtn_1.addEventListener("click", AddDocument);

      //section2
      // async function AddDocument2() {
      //   //firestoreå†…ã®SearchOfFoodã‚’å–å¾—
      //   const docsnap = await getDoc(doc(db, "FoodList", search_box.value));
      //   //â†‘ä½•å›ã‚‚æ›¸ã„ã¦è¦šãˆã‚‹
      //   if (docsnap.exists()) {
      //     // firestoreã«search_boxã«ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã¨ã;
      //     $();
      //     // name1ã«firestoreã®NameOfFoodã‚’è¡¨ç¤º;
      //     $("#name2").val(docsnap.data().NameOfFood);
      //     console.log(docsnap);
      //     //cal1ã«firestoreã®Calorieã‚’è¡¨ç¤º
      //     $("#cal2").val(docsnap.data().Calorie);
      //     //p1ã«firestoreã®Proteinã‚’è¡¨ç¤º
      //     $("#p2").val(docsnap.data().Protein);
      //     //f1ã«firestoreã®Fatã‚’è¡¨ç¤º
      //     $("#f2").val(docsnap.data().Fat);
      //     //c1ã«firestoreã®Carboã‚’è¡¨ç¤º
      //     $("#c2").val(docsnap.data().Calorie);
      //   } else {
      //     //ãªã„æ™‚â†’ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
      //     alert("No such Document....");
      //   }
      // }
      // //ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      // addbtn_2.addEventListener("click", AddDocument2);

      //section3
      // async function AddDocument3() {
      //   //firestoreå†…ã®SearchOfFoodã‚’å–å¾—
      //   const docsnap = await getDoc(doc(db, "FoodList", search_box.value));
      //   //â†‘ä½•å›ã‚‚æ›¸ã„ã¦è¦šãˆã‚‹
      //   if (docsnap.exists()) {
      //     // firestoreã«search_boxã«ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã¨ã;
      //     // name1ã«firestoreã®NameOfFoodã‚’è¡¨ç¤º;
      //     $("#name3").val(docsnap.data().NameOfFood);
      //     console.log(docsnap);
      //     //cal1ã«firestoreã®Calorieã‚’è¡¨ç¤º
      //     $("#cal3").val(docsnap.data().Calorie);
      //     //p1ã«firestoreã®Proteinã‚’è¡¨ç¤º
      //     $("#p3").val(docsnap.data().Protein);
      //     //f1ã«firestoreã®Fatã‚’è¡¨ç¤º
      //     $("#f3").val(docsnap.data().Fat);
      //     //c1ã«firestoreã®Carboã‚’è¡¨ç¤º
      //     $("#c3").val(docsnap.data().Calorie);
      //   } else {
      //     //ãªã„æ™‚â†’ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
      //     alert("No such Document....");
      //   }
      // }
      // //ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      // addbtn_3.addEventListener("click", AddDocument3);

      ///////////////////////UPDATE////////////////
      //updbtnã‚’æŠ¼ã™â†’ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      $("#updbtn").on("click", function () {
        const ob = {
          //inputã‚¿ã‚°,id=name_boxã‚’å–å¾—
          NameOfFood: $("#name_box").val(),
          //inputã‚¿ã‚°,id=cal_boxã‚’å–å¾—
          Calorie: $("#cal_box").val(),
          //inputã‚¿ã‚°,id=p_boxã‚’å–å¾—
          Protein: $("#p_box").val(),
          //inputã‚¿ã‚°,id=f_boxã‚’å–å¾—
          Fat: $("#f_box").val(),
          //inputã‚¿ã‚°,id=c_boxã‚’å–å¾—
          Carbo: $("#c_box").val(),
        };
        updateDoc(doc(db, "FoodList", search_box.value), ob);
        //â†‘ä½•å›ã‚‚æ›¸ã„ã¦è¦šãˆã‚‹
        try {
          //ã‚¢ãƒ—ãƒ‡â†’ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("data updated successfully!!");
        } catch (error) {
          //ã‚¨ãƒ©ãƒ¼ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("Unsuccessful operation error");
        }
      });
      ////////////////////////////////////////////////////////////

      /////////////////////DELETEã‚»ã‚¯ã‚·ãƒ§ãƒ³////////////////////////
      //delãƒœã‚¿ãƒ³ã‚’æŠ¼ã™â†’RollNoã‹ã‚‰firestoreä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
      async function DeleteDocument() {
        let ref = doc(db, "FoodList", search_box.value);
        const docsnap = await getDoc(ref);
        if (!docsnap.exists()) {
          alert("document does not existğŸ˜¢");
          return;
        }

        await deleteDoc(ref);
        try {
          alert("data deleted successfully!!");
        } catch (error) {
          alert("Unsuccessful operation error");
        }
      }
      delbtn.addEventListener("click", DeleteDocument);
      /////////////////////////////////////////////////////////////

      //firestoreå†…ã®RollNoã‚’å–å¾—
      // $("#food").on("click", function () {
      //   const docsnap = getDoc(doc(db, "FoodHistory"));
      //   console.log(docsnap);
      // });

      // async function GetFood() {
      //   //firestoreå†…ã®SearchOfFoodã‚’å–å¾—
      //   const docRef = doc(db, "FoodHistory");
      //   const docSnap = await getDoc(docRef);
      //   if (docSnap.exists()) {
      //     console.log("Document data:", docSnap.data());
      //   } else {
      //     // doc.data() will be undefined in this case
      //     console.log("No such document!");
      //   }
      // }
      // //ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      // food.addEventListener("click", GetFood);

      // onSnapshot(collection(db, "meal_history"), (querySnapshot) => {
      //   // console.log(querySnapshot.docs);

      //   const dataArray = [];
      //   querySnapshot.docs.forEach(function (doc) {
      //     const data = {
      //       id: doc.id,
      //       data: doc.data(),
      //     };
      //     dataArray.push(data);
      //   });
      //   $("#output").val(dataArray);
      //   console.log(dataArray);
      // });

      $("#send").on("click", function () {
        // é€ä¿¡æ™‚ã«å¿…è¦ãªå‡¦ç†
        const data = {
          breakfast: {
            0: {
              name: $("#name").val(),
              kcal: $("#kcal").val(),
              amount: $("#amount").val(),
            },
          },
          dateTime: $("#date").val(),
        };
        console.log(data);
        addDoc(collection(db, "meal_history"), data);
      });
      // function FoodHistory() {

      // }
    </script>
  </body>
</html>
