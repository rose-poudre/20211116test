<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>é£Ÿäº‹å…¥åŠ›</title>
  </head>
  <body>
    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºå†…å®¹ -->
    <div class="container">
      <!-- <label class="name">æ¤œç´¢</label> -->
      <input
        type="text"
        id="search_box"
        placeholder="ã²ã‚‰ãŒãªã§æ¤œç´¢ï¼ˆä¾‹:ãŠã«ãã‚Šï¼‰"
        style="width: 300px"
      />
      <button id="selbtn" style="background-color: aqua">SELECT</button
      ><br /><br />

      <!-- æ¤œç´¢ã—ãŸã‚‚ã®ã‚’è¡¨ç¤º -->
      <div>
        <!-- <label class="">é£Ÿå“å</label> -->
        <input type="text" id="name_box" style="border: none; width: 100px" />
        <!-- <label class="">ã‚«ãƒ­ãƒªãƒ¼</label> -->
        <input
          type="text"
          id="cal_box"
          style="border: none; width: 50px"
        />kcal<br /><br />
        <label class="">ã‚¿ãƒ³ãƒ‘ã‚¯è³ª</label>
        <input type="text" id="p_box" style="border: none; width: 20px" />g
        <label class="">è„‚è³ª</label>
        <input type="text" id="f_box" style="border: none; width: 20px" />g
        <label class="">ç‚­æ°´åŒ–ç‰©</label>
        <input
          type="text"
          id="c_box"
          style="border: none; width: 30px"
        />g<br /><br />
      </div>
      <hr />
      <button id="addbtn">è¿½åŠ </button>
      <hr />

      <hr />
      <button id="insbtn">INSERT</button>
      <button id="updbtn">UPDATE</button>
      <button id="delbtn">DELETE</button>
    </div>
    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºå†…å®¹ -->

    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- JQuery -->

    <!--** ä»¥ä¸‹Firebase **-->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-app.js";
      //33ã€œ41è¡Œç›®ã¾ã§ã¯è¿½åŠ ã§è¨˜å…¥ï¼ï¼
      import {
        //importå†…ã¯ä½¿ç”¨ã™ã‚‹é–¢æ•°ã‚’å®šç¾©
        getFirestore,
        collection,
        doc,
        addDoc,
        getDoc,
        setDoc,
        updateDoc,
        deleteDoc,
        deleteField,
        serverTimestamp,
        query,
        orderBy,
        onSnapshot,
        Timestamp,
      } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-firestore.js"; //importã«å®šç¾©ã—ãŸã®ã‚’firestoreã§ä½¿ç”¨

      const firebaseConfig = {
        //apikeyã¯æ¶ˆã™ï¼
        apiKey: "AIzaSyDw1RoxNMfAE1AlZWzYN6JLeXcTjp71sgA",
        authDomain: "work-d7939.firebaseapp.com",
        projectId: "work-d7939",
        storageBucket: "work-d7939.appspot.com",
        messagingSenderId: "819553065695",
        appId: "1:819553065695:web:82cdcaaa9282b498a1676a",
      };
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app); //firestoreã‚’ä½¿ã†ã‚ˆ

      //ãƒ†ã‚­ã‚¹ãƒˆãƒ»ãƒœã‚¿ãƒ³å®šæ•°ã‚’å®šç¾©
      let searchbox = document.getElementById("search_box");
      let namebox = document.getElementById("name_box");
      let calbox = document.getElementById("cal_box");
      let pbox = document.getElementById("p_box");
      let fbox = document.getElementById("f_box");
      let cbox = document.getElementById("c_box");

      let insbtn = document.getElementById("insbtn");
      let selbtn = document.getElementById("selbtn");
      let updbtn = document.getElementById("updbtn");
      let delbtn = document.getElementById("delbtn");

      //INSERTãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      $("#insbtn").on("click", function () {
        const ob = {
          //inputã‚¿ã‚°,id=search_boxã‚’å–å¾—
          SearchOfFood: $("#search_box").val(),
          //inputã‚¿ã‚°,id=name_boxã‚’å–å¾—
          NameOfFood: $("#name_box").val(),
          //inputã‚¿ã‚°,id=cal_boxã‚’å–å¾—
          Calorie: $("#cal_box").val(),
          //inputã‚¿ã‚°,id=p_boxã‚’å–å¾—
          Protein: $("#p_box").val(),
          //inputã‚¿ã‚°,id=f_boxã‚’å–å¾—
          Fat: $("#f_box").val(),
          //inputã‚¿ã‚°,id=c_boxã‚’å–å¾—
          Carbo: $("#c_box").val(),
        };

        //ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã€ŒFoodListã€å†…ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ŒNameOfFoodã€ã‚’ã‚»ãƒƒãƒˆ
        setDoc(doc(db, "FoodList", search_box.value), ob);
        try {
          //ã‚»ãƒƒãƒˆæˆåŠŸã—ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("data added successfully!!");
          $("#search_box").val("");
          $("#name_box").val("");
          $("#cal_box").val("");
          $("#p_box").val("");
          $("#f_box").val("");
          $("#c_box").val("");
        } catch (error) {
          //ã‚»ãƒƒãƒˆå¤±æ•—ã—ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("Unsuccessful operation error");
        }
      });

      /////////////////////SELECTã‚»ã‚¯ã‚·ãƒ§ãƒ³////////////////////////
      // selãƒœã‚¿ãƒ³ã‚’æŠ¼ã™â†’SearchOfFoodã‹ã‚‰firestoreä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›
      async function GetDocument() {
        //firestoreå†…ã®RollNoã‚’å–å¾—
        const docsnap = await getDoc(doc(db, "FoodList", search_box.value));
        //â†‘ä½•å›ã‚‚æ›¸ã„ã¦è¦šãˆã‚‹
        if (docsnap.exists()) {
          //firestoreã«search_boxã«ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã¨ã
          //name_boxã«firestoreã®NameOfFoodã‚’è¡¨ç¤º
          $("#name_box").val(docsnap.data().NameOfFood);
          //cal_boxã«firestoreã®Calorieã‚’è¡¨ç¤º
          $("#cal_box").val(docsnap.data().Calorie);
          //p_boxã«firestoreã®Proteinã‚’è¡¨ç¤º
          $("#p_box").val(docsnap.data().Protein);
          //f_boxã«firestoreã®Fatã‚’è¡¨ç¤º
          $("#f_box").val(docsnap.data().Fat);
          //c_boxã«firestoreã®Carboã‚’è¡¨ç¤º
          $("#c_box").val(docsnap.data().Calorie);
        } else {
          //ãªã„æ™‚â†’ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("No such Document....");
        }
      }
      //ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      selbtn.addEventListener("click", GetDocument);
      /////////////////////////////////////////////

      // addãƒœã‚¿ãƒ³ã‚’æŠ¼ã™â†’SearchOfFoodã‹ã‚‰firestoreä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›

      ///////////////////////UPDATE////////////////
      //updbtnã‚’æŠ¼ã™â†’ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
      $("#updbtn").on("click", function () {
        const ob = {
          //inputã‚¿ã‚°,id=name_boxã‚’å–å¾—
          NameOfFood: $("#name_box").val(),
          //inputã‚¿ã‚°,id=cal_boxã‚’å–å¾—
          Calorie: $("#cal_box").val(),
          //inputã‚¿ã‚°,id=p_boxã‚’å–å¾—
          Protein: $("#p_box").val(),
          //inputã‚¿ã‚°,id=f_boxã‚’å–å¾—
          Fat: $("#f_box").val(),
          //inputã‚¿ã‚°,id=c_boxã‚’å–å¾—
          Carbo: $("#c_box").val(),
        };
        updateDoc(doc(db, "FoodList", search_box.value), ob);
        //â†‘ä½•å›ã‚‚æ›¸ã„ã¦è¦šãˆã‚‹
        try {
          //ã‚¢ãƒ—ãƒ‡â†’ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("data updated successfully!!");
        } catch (error) {
          //ã‚¨ãƒ©ãƒ¼ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ
          alert("Unsuccessful operation error");
        }
      });
      ////////////////////////////////////////////////////////////

      /////////////////////DELETEã‚»ã‚¯ã‚·ãƒ§ãƒ³////////////////////////
      //delãƒœã‚¿ãƒ³ã‚’æŠ¼ã™â†’RollNoã‹ã‚‰firestoreä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
      async function DeleteDocument() {
        let ref = doc(db, "FoodList", search_box.value);
        const docsnap = await getDoc(ref);
        if (!docsnap.exists()) {
          alert("document does not existğŸ˜¢");
          return;
        }

        await deleteDoc(ref);
        try {
          alert("data deleted successfully!!");
        } catch (error) {
          alert("Unsuccessful operation error");
        }
      }
      delbtn.addEventListener("click", DeleteDocument);
      /////////////////////////////////////////////////////////////
    </script>
  </body>
</html>
